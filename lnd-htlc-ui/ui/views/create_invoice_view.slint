import { LineEdit } from "std-widgets.slint";

// 1. Create Custom Invoice View
export component CreateCustomInvoiceView {
    callback create-clicked(string, string, string, string); // preimage_x, preimage_h, amount, memo
    callback request-preimage-generation();
    callback confirm-preimage(string, string); // preimage_x, preimage_h

    in-out property <string> generated-preimage-x: "";
    in-out property <string> generated-preimage-h: "";
    in-out property <string> payment-address: "";
    in-out property <bool> preimage-confirmed: false;
    in property <string> custom-invoice-status-message: "";
    
    VerticalLayout {
        spacing: 16px;
        
        // Header
        Text {
            text: "Create Custom Invoice";
            font-size: 24px;
            font-weight: 600;
            color: #e0e0e0;
        }
        
        Rectangle {
            vertical-stretch: 1;
            background: #2a2a2a;
            border-radius: 8px;
            
            VerticalLayout {
                padding: 24px;
                spacing: 16px;
                
                Text {
                    text: "Create a custom invoice with your own preimage:";
                    color: #e0e0e0;
                    font-weight: 500;
                }

                Rectangle {
                    height: 8px;
                }
                
                HorizontalLayout {
                    alignment: center;
                    
                    TouchArea {
                        Rectangle {
                            width: 160px;
                            height: 42px;
                            border-radius: 4px;
                            background: #5294e2;
                            
                            Text {
                                text: "Generate H/X";
                                color: white;
                                font-weight: 600;
                                horizontal-alignment: center;
                                vertical-alignment: center;
                            }
                        }
                        clicked => {
                            root.request-preimage-generation();
                        }
                    }
                }

                Rectangle {
                    height: 8px;
                }

                VerticalLayout {
                    spacing: 8px;

                    Text {
                        text: "Preimage (X)";
                        color: #c0c0c0; // Lighter color for generated output
                    }

                    generated_preimage_x := LineEdit {
                        placeholder-text: root.generated_preimage_x;
                        height: 36px;
                        width: 100%;
                    }
                    
                    Text {
                        text: "Payment Hash (H)";
                        color: #c0c0c0; // Lighter color for generated output
                    }
                    
                    generated_preimage_h := LineEdit {
                        placeholder-text: root.generated_preimage_h;
                        height: 36px;
                        width: 100%;
                    }
                }

                Rectangle {
                    height: 4px;
                }

                HorizontalLayout {
                    alignment: center;
                    
                    TouchArea {
                        enabled: root.generated_preimage_x != "" && root.generated_preimage_h != "";
                        Rectangle {
                            width: 100px;
                            height: 36px;
                            border-radius: 4px;
                            background: root.generated_preimage_x != "" && root.generated_preimage_h != "" ? #20dd4f : #808080;
                            
                            Text {
                                text: "Confirm X";
                                color: white;
                                font-weight: 600;
                                horizontal-alignment: center;
                                vertical-alignment: center;
                            }
                        }
                        clicked => {
                            root.confirm-preimage(root.generated_preimage_x, root.generated_preimage_h);
                        }
                    }

                    if root.preimage-confirmed:
                        Text {
                            text: "âœ…";
                            height: 14px;
                            color: #5294e2;
                            font-weight: 500;
                        }
                    
                }
                
                Rectangle {
                    height: 4px;
                }
                
                VerticalLayout {
                    spacing: 8px;
                    
                    Text {
                        text: "Amount (sats):";
                        color: #e0e0e0;
                    }
                    
                    amount := LineEdit {
                        placeholder-text: "Amount in satoshis";
                        height: 36px;
                    }
                }
                
                VerticalLayout {
                    spacing: 8px;
                    
                    Text {
                        text: "Memo:";
                        color: #e0e0e0;
                    }
                    
                    memo := LineEdit {
                        placeholder-text: "Optional description for the invoice";
                        height: 36px;
                    }
                }

                Rectangle {
                    height: 8px;
                }
                
                TouchArea {
                    enabled: root.generated_preimage_x != "" && root.generated_preimage_h != "" && amount.text != "";
                    Rectangle {
                        width: 160px;
                        height: 42px;
                        border-radius: 4px;
                        background: root.generated_preimage_x != "" && root.generated_preimage_h != "" && amount.text != "" ? #5294e2 : #808080;
                        
                        Text {
                            text: "Create Invoice";
                            color: white;
                            font-weight: 600;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                    }
                    clicked => {
                        root.create-clicked(root.generated_preimage_x, root.generated_preimage_h, amount.text, memo.text);
                    }
                }

                Rectangle {
                    height: 8px;
                }

                if root.payment_address != "": Text {
                    text: "Payment Address: \{root.payment_address}";
                    color: #5294e2;
                    font-weight: 500;
                    font-size: 14px;
                    horizontal-alignment: left;
                    vertical-alignment: center;
                    padding: 8px;
                }

                if root.custom-invoice-status-message != "": Text {
                    text: root.custom-invoice-status-message;
                    color: #e76a3d;
                    font-weight: 500;
                    font-size: 14px;
                    horizontal-alignment: left;
                    wrap: word-wrap;
                }
            }
        }
    }
}
